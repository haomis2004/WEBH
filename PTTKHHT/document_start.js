!function(){var o;t=function(){var g={name:"mustache.js",version:"0.7.0",tags:["{{","}}"]};g.Scanner=C,g.Context=r,g.Writer=t;var f=/\s*/,m=/\s+/,n=/\S/,v=/\s*=/,w=/\s*\}/,y=/#|\^|\/|>|\{|&|=|!/;function E(t){return e=n,t=t,!RegExp.prototype.test.call(e,t);var e}var l=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function b(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function C(t){this.string=t,this.tail=t,this.pos=0}function r(t,e){this.view=t,this.parent=e,this.clearCache()}function t(){this.clearCache()}function d(t){for(var e,n=t[3],o=n;(e=t[4])&&e.length;)o=(t=e[e.length-1])[3];return[n,o]}function N(t){if(2!==t.length)throw new Error("Invalid tags: "+t.join(" "));return[new RegExp(b(t[0])+"\\s*"),new RegExp("\\s*"+b(t[1]))]}g.escape=function(t){return String(t).replace(/[&<>"'\/]/g,function(t){return e[t]})},C.prototype.eos=function(){return""===this.tail},C.prototype.scan=function(t){t=this.tail.match(t);return t&&0===t.index?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},C.prototype.scanUntil=function(t){var e,t=this.tail.search(t);switch(t){case-1:e=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,t),this.tail=this.tail.substring(t),this.pos+=t}return e},r.make=function(t){return t instanceof r?t:new r(t)},r.prototype.clearCache=function(){this._cache={}},r.prototype.push=function(t){return new r(t,this)},r.prototype.lookup=function(t){if(!(i=this._cache[t])){if("."===t)i=this.view;else for(var e=this;e;){if(0<t.indexOf("."))for(var n=t.split("."),o=0,i=e.view;i&&o<n.length;)i=i[n[o++]];else i=e.view[t];if(null!=i)break;e=e.parent}this._cache[t]=i}return"function"==typeof i&&(i=i.call(this.view)),i},t.prototype.clearCache=function(){this._cache={},this._partialCache={}},t.prototype.compile=function(t,e){return this._compile(this._cache,t,t,e)},t.prototype.compilePartial=function(t,e,n){return this._compile(this._partialCache,t,e,n)},t.prototype.render=function(t,e,n){return this.compile(t)(e,n)},t.prototype._compile=function(t,e,o,n){var i,s;return t[e]||(i=function i(a){var s={};function l(t,e,n){var o;return s[t]||(o=i(e),s[t]=function(t,e){return o(t,e,n)}),s[t]}function t(t,e,n){for(var o,i,s="",r=0,c=a.length;r<c;++r)switch((o=a[r])[0]){case"#":i=n.slice.apply(n,d(o)),s+=t._section(o[1],e,i,l(r,o[4],n));break;case"^":s+=t._inverted(o[1],e,l(r,o[4],n));break;case">":s+=t._partial(o[1],e);break;case"&":s+=t._name(o[1],e);break;case"name":s+=t._escaped(o[1],e);break;case"text":s+=o[1]}return s}return t}(g.parse(o,n)),s=this,t[e]=function(t,e){if(e)if("function"==typeof e)s._loadPartial=e;else for(var n in e)s.compilePartial(n,e[n]);return i(s,r.make(t),o)}),t[e]},t.prototype._section=function(t,e,n,o){var i=e.lookup(t);switch(typeof i){case"object":if(l(i)){for(var s="",r=0,c=i.length;r<c;++r)s+=o(this,e.push(i[r]));return s}return i?o(this,e.push(i)):"";case"function":var a=this;return i.call(e.view,n,function(t){return a.render(t,e)})||"";default:if(i)return o(this,e)}return""},t.prototype._inverted=function(t,e,n){t=e.lookup(t);return!t||l(t)&&0===t.length?n(this,e):""},t.prototype._partial=function(t,e){t in this._partialCache||!this._loadPartial||this.compilePartial(t,this._loadPartial(t));t=this._partialCache[t];return t?t(e):""},t.prototype._name=function(t,e){t=e.lookup(t);return"function"==typeof t&&(t=t.call(e.view)),null==t?"":String(t)},t.prototype._escaped=function(t,e){return g.escape(this._name(t,e))},g.parse=function(t,e){var n,o,i=N(e=e||g.tags),s=new C(t),r=[],c=[],a=!1,l=!1;for(;!s.eos();){if(n=s.pos,p=s.scanUntil(i[0]))for(var d=0,u=p.length;d<u;++d)E(o=p.charAt(d))?c.push(r.length):l=!0,r.push(["text",o,n,n+1]),n+=1,"\n"===o&&function(){if(a&&!l)for(;c.length;)r.splice(c.pop(),1);else c=[];l=a=!1}();if(n=s.pos,!s.scan(i[0]))break;var h,p,a=!0,_=s.scan(y)||"name";if(s.scan(f),"="===_?(p=s.scanUntil(v),s.scan(v),s.scanUntil(i[1])):"{"===_?(h=new RegExp("\\s*"+b("}"+e[1])),p=s.scanUntil(h),s.scan(w),s.scanUntil(i[1]),_="&"):p=s.scanUntil(i[1]),!s.scan(i[1]))throw new Error("Unclosed tag at "+s.pos);r.push([_,p,n,s.pos]),"name"!==_&&"{"!==_&&"&"!==_||(l=!0),"="===_&&(i=N(e=p.split(m)))}return function(t){for(var e,n,o=0;o<t.length;++o)e=t[o],n&&"text"===n[0]&&"text"===e[0]?(n[1]+=e[1],n[3]=e[3],t.splice(o--,1)):n=e}(r),function(t){for(var e,n,o=[],i=o,s=[],r=0;r<t.length;++r)switch((e=t[r])[0]){case"#":case"^":e[4]=[],s.push(e),i.push(e),i=e[4];break;case"/":if(0===s.length)throw new Error("Unopened section: "+e[1]);if((n=s.pop())[1]!==e[1])throw new Error("Unclosed section: "+n[1]);i=0<s.length?s[s.length-1][4]:o;break;default:i.push(e)}if(n=s.pop())throw new Error("Unclosed section: "+n[1]);return o}(r)};var o=new t;return g.clearCache=function(){return o.clearCache()},g.compile=function(t,e){return o.compile(t,e)},g.compilePartial=function(t,e,n){return o.compilePartial(t,e,n)},g.render=function(t,e,n){return o.render(t,e,n)},g.to_html=function(t,e,n,o){n=g.render(t,e,n);if("function"!=typeof o)return n;o(n)},g}(),"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define?define(t):o=t,window.Mustache=o;var d={};d.query=function(t,e){return(e=e||document).querySelector(t)},d.queryAll=function(t,e){return(e=e||document).querySelectorAll(t)},Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector),d.getNearest=function(t,e){return function(t){for(var e=this;e&&(!e.matches||!e.matches(t));)e=e.parentNode;return e}.call(t,e)},d.getElement=function(t){for(;t&&1!==t.nodeType;)t=t.parentNode;return t},d.checkDarkPage=function(){var t=window.getComputedStyle(document.body).backgroundColor;if(!t)return!1;var n=/rgba?\((\d+)\,\s(\d+)\,\s(\d+)(\,\s(\d+))?\)/g.exec(t);return(!n[4]||0!=+n[5])&&((n=[+n[1],+n[2],+n[3]]).forEach(function(t,e){t/=255;n[e]=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}),!(.179<.2126*n[0]+.7152*n[1]+.0722*n[2]))},d.thouShallNotPass=function(t){return t.preventDefault(),t.stopPropagation(),!1},d.noop=function(){},"undefined"==typeof PRODUCTION&&(d.throttle=function(t,e){var n,o=null;return function(){o?n=arguments:(n=arguments,o=setTimeout(function(){return o=null,t.apply(this,n)},e))}},d.html=function(t){var e=document.createElement(t.tag||"keke");if(t.style)for(var n in t.style)e.style[n]=t.style[n];return t.text&&(e.textContent=t.text),e},d.attachShadow=function(t){return t.attachShadow?t.attachShadow({mode:"open"}):t.createShadowRoot()}),window.Utils=d;var u=function(t){if(0===arguments.length)return this._init(),this;if(t instanceof u)return t;var e=new u;return e.resolve(t),e};u.RUNNING=0,u.RESOLVED=1,u.FAILED=2,u.prototype={constructor:u,_init:function(){this._results=[],this._subscribers=[],this.state=u.RUNNING},_notify:function(){var e=this;this._subscribers.forEach(function(t){t.apply(e,e._results)}),this._subscribers=[]},resolve:function(){return this.state=u.RESOLVED,this._results=arguments,this._notify(),this},reject:function(){return this.state=u.FAILED,this._results=arguments,this._notify(),this},subscribe:function(t){this.state!==u.RUNNING?t.apply(this,this._results):this._subscribers.push(t)},done:function(t){return this.subscribe(t),this},success:function(t){var e=this;return this.subscribe(function(){e.state===u.RESOLVED&&t.apply(e,e._results)}),this},fail:function(t){var e=this;return this.subscribe(function(){e.state===u.FAILED&&t.apply(e,e._results)}),this},bind:function(t){return(t=new u(t)).success(this.resolve.bind(this)).fail(this.reject.bind(this)),this}},u.when=function(){var t=[],t=Array.isArray(arguments[0])?arguments[0]:d.toArray(arguments);return new u.When(t)},u.When=function(t){this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[],this._state=u.RUNNING,this._thingsToDo=t.length,this._results=Array(this._thingsToDo),this._init(t)},u.When.prototype={constructor:u.When,_init:function(t){var n=this;t.forEach(function(t,e){(t=new u(t)).subscribe(function(){t.state===u.FAILED&&(n._state=u.FAILED),n._results[e]=d.toArray(arguments),n._thingsToDo--,n._checkIsDone()})}),this._checkIsDone()},_checkIsDone:function(){if(0!==this._thingsToDo)return!1;var e=[];this._results.forEach(function(t){e=e.concat(t)}),this._state===u.FAILED?this._runCallbacks(this._failCallbacks,e):this._runCallbacks(this._successCallbacks,e),this._runCallbacks(this._doneCallbacks,e),this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[]},_runCallbacks:function(t,e){t.forEach(function(t){t.apply(this,e)})},done:function(t){return this._doneCallbacks.push(t),this._checkIsDone(),this},success:function(t){return this._successCallbacks.push(t),this._checkIsDone(),this},fail:function(t){return this._failCallbacks.push(t),this._checkIsDone(),this}},u.chain=function(){var o=new u,i=[];return function e(n){if(!n.length)return o.resolve.apply(o,i);var t=n.shift();"function"==typeof t?u(t()).done(function(t){i.push(t),e(n)}):(i.push(t),e(n))}(Array.isArray(arguments[0])?arguments[0]:d.toArray(arguments)),o},window.Promise=u,Notifier=function(){this._subscribers=[]},Notifier.prototype={constructor:Notifier,addListener:function(t){return"function"==typeof t&&this._subscribers.push(t),this},unsubscribe:function(t){t=this._subscribers.indexOf(t);return-1!==t&&this._subscribers.splice(t,1),this},trigger:function(){var e=arguments,n=this;return this._subscribers.forEach(function(t){t.apply(n,e)}),this}};window;var c=["text","tel","url"],t=function(){this._lastSelectionText=this.getText(),this.onSelect=new Notifier,this.onDeselect=new Notifier;var o=this._checkSelection.bind(this);document.addEventListener("mouseup",o,!1),document.addEventListener("contextmenu",o,!1),document.addEventListener("select",o,!1),this.listActivedFrameDocuments=[],this.listFuncListeners=[],window.addEventListener("load",function(){for(var t,e=document.querySelectorAll("iframe"),n=0;n<e.length;n++)e[n].contentDocument&&(t=function(e,n){return function(t){e(t,n)}}(o,e[n]),this.listActivedFrameDocuments.push(e[n].contentDocument),this.listFuncListeners.push(t),e[n].contentDocument.addEventListener("mouseup",t,!1),e[n].contentDocument.addEventListener("keyup",t,!1),e[n].contentDocument.addEventListener("contextmenu",t,!1),e[n].contentDocument.addEventListener("select",t,!1))}.bind(this),!1),window.addEventListener("beforeunload",function(){for(var t=0;t<this.listActivedFrameDocuments.length;t++)this.listActivedFrameDocuments[t].removeEventListener("mouseup",this.listFuncListeners[t],!1),this.listActivedFrameDocuments[t].removeEventListener("keyup",this.listFuncListeners[t],!1),this.listActivedFrameDocuments[t].removeEventListener("contextmenu",this.listFuncListeners[t],!1),this.listActivedFrameDocuments[t].removeEventListener("select",this.listFuncListeners[t],!1);this.listActivedFrameDocuments=[],this.listFuncListeners=[]}.bind(this),!1)};function a(t){return t.toString().trim()}function l(t,e){for(;t&&t.parentNode;){if(t===e)return 1;t=t.parentNode}}t.prototype={constructor:t,_checkSelection:function(t,e){if("input"!==t.target.tagName.toLowerCase()){if(d.getNearest(t.target,".corom-element")&&(this._lastContextMenu=this._lastSelectionText,this._lastSelectionText=null),d.getNearest(t.target,".corom-element")||"keyup"===t.type&&"textarea"!==t.target.tagName.toLowerCase())return"input"!==t.target.tagName.toLowerCase()?void 0:(this.onDeselect.trigger(!0),!0);"mouseup"===t.type&&(this._lastMouseupEvent=t),this.contextElement=e;var n,o,i=this.getContextWindow().getSelection(),s=a(i),r=d.getElement(i.focusNode);if(s&&this._lastSelectionText===s&&(i.containsNode(t.target,!0)||l(t.target,r)||l(r,t.target)))return"contextmenu"!==t.type&&(this._lastContextMenu=this._lastSelectionText,this._lastSelectionText=null),this.onDeselect.trigger(),!0;s&&"contextmenu"===t.type?this._lastSelectionText=this._lastContextMenu||this._lastSelectionText:(this.onDeselect.trigger(),s?(e=this.getSelectionCoords(i),i="select"===t.type?t.target:r,e||"select"!==t.type||(n="text",(o=t.target)&&("TEXTAREA"===o.tagName||"INPUT"===(r=o).tagName&&-1<c.indexOf(r.type))&&o.selectionStart!=o.selectionEnd&&(e=this.getTextBoundingRect(o,o.selectionStart,o.selectionEnd),n="input",i=o),t.detail=this._lastMouseupEvent.detail),"input"!==n&&(n=function(t){if("true"===t.contentEditable)return!0;for(;t=t.parentNode;)if("true"===t.contentEditable)return!0;return!1}(i)?"input":"notInput"),e&&(this._lastSelectionText=s,o=this.getSelectionStyle(d.getElement(i)),i=(i=this.getContextWindow().getComputedStyle(d.getElement(i)).getPropertyValue("zoom"))?parseInt(i):1,e.right+=this.getContextPositionLeft(),e.left+=this.getContextPositionLeft(),e.top+=this.getContextPositionTop(),e.bottom+=this.getContextPositionTop(),e.left*=i,e.right*=i,e.top*=i,e.bottom*=i,e.height*=i,e.width*=i,this.onSelect.trigger({element:t.target,text:s,coords:e,style:o,source:n,detail:t.detail}))):this._lastSelectionText=null)}},getContextWindow:function(){return this.contextElement?this.contextElement.contentWindow:window},getContextDocument:function(){return this.contextElement?this.contextElement.contentDocument:document},getContextPositionTop:function(){return this.contextElement?this.contextElement.getBoundingClientRect().top:0},getContextPositionLeft:function(){return this.contextElement?this.contextElement.getBoundingClientRect().left:0},getCoords:function(){return this.getSelectionCoords(this.getContextWindow().getSelection())},getStyle:function(){return this.getSelectionStyle(this.getContextWindow().getSelection())},getText:function(){return a(this.getContextWindow().getSelection())},getBoundTop:function(t){var e=t.getBoundingClientRect(),n=this.getContextWindow().getComputedStyle(t);return e.top+t.clientTop+parseInt(n["padding-top"])||0},getSelectionStyle:function(t){var e=d.getElement(t);if(!e)return{background:"highlight"};var n=this.getContextWindow().getComputedStyle(e).backgroundColor,o=this.getContextWindow().getComputedStyle(e,"::selection"),i=parseInt(o.lineHeight),s=i,r=o.backgroundColor,t=o.color,e=this.getContextWindow().navigator.userAgent.match(/Windows/i);return"rgba(0, 0, 0, 0)"!==r&&r!==n||(r=e?"#328efe":"highlight"),isNaN(s)&&(s=1.14*parseInt(o.fontSize)),{lineHeight:i,assumedLineHeight:s,background:r,color:t}},getElementOffset:function(t){var e=this.getContextDocument().body,n=this.getContextDocument().documentElement,o=this.getContextDocument().createElement("div");o.style.paddingLeft=o.style.width="1px",e.appendChild(o);var i=2==o.offsetWidth;e.removeChild(o),o=t.getBoundingClientRect();var s=n.clientTop||e.clientTop||0,r=n.clientLeft||e.clientLeft||0,t=this.getContextWindow().pageYOffset||i&&n.scrollTop||e.scrollTop,e=this.getContextWindow().pageXOffset||i&&n.scrollLeft||e.scrollLeft;return{top:o.top+t-s,left:o.left+e-r}},getTextBoundingRect:function(t,e,n,o){if(!(t&&"value"in t))return null;if(n<=e)return null;var i=this.getContextWindow().getComputedStyle(t),s=this.getElementOffset(t),r=s.top,c=s.left,a=parseFloat(i.width),l=parseFloat(i.height);r+=parseFloat(i["padding-top"]),r+=parseFloat(i["border-top-width"]),c+=parseFloat(i["padding-left"]),c+=parseFloat(i["border-left-width"]),c+=1;var d=function(t){for(var e=["direction","font-family","font-size","font-size-adjust","font-variant","font-weight","font-style","letter-spacing","line-height","text-align","text-indent","text-transform","word-wrap","word-spacing"],n="white-space:pre;padding:0;margin:0;",o=0;o<e.length;o++){var i=e[o];n+=i+":"+t.getPropertyValue(i)+";"}return n}(i),u=t.value,h=u.length,s=this.getContextDocument().createElement("div");0<e&&this.appendSpanElement(s,d,u.substring(0,e));e=this.appendSpanElement(s,d,u.substring(e,n));n<h&&this.appendSpanElement(s,d,u.substring(n,h)),s.style.cssText=d,s.style.position="absolute",s.style.top=r+"px",s.style.left=c+"px",s.style.width=a+"px",s.style.height=l+"px",s.style.overflowWrap="break-word",s.style.paddingRight=i.paddingRight,this.getContextDocument().body.appendChild(s);e=e.getBoundingClientRect();return(e={bottom:e.bottom,top:e.top,height:e.height,left:e.left,right:e.right,width:e.width}).left-=t.scrollLeft,e.right-=t.scrollLeft,e.bottom-=t.scrollTop,e.top-=t.scrollTop,o||s.parentNode.removeChild(s),e},appendSpanElement:function(t,e,n){var o=this.getContextDocument().createElement("span");return o.style.cssText=e,o.style.whiteSpace="normal",o.textContent=n,t.appendChild(o),o},getSelectionCoords:function(t){if(t.rangeCount){var e=t.getRangeAt(t.rangeCount-1),t=this.getSelectionStyle(t);return this.getCorrectedRangeRect(e,t)}return null},getCorrectedRangeRect:function(t,e){var n=t.getBoundingClientRect();if(n.width&&n.height){var o=e.lineHeight,t=t.endContainer.parentElement,t=this.getBoundTop(d.getElement(t)),o=n.bottom-t<1.5*e.assumedLineHeight?t:o?n.bottom-o:n.top;return{left:n.left,right:n.right,top:o,bottom:n.bottom,height:n.bottom-o,width:n.width}}}},"undefined"==typeof PRODUCTION&&(t.prototype.__drawRect=function(t,e){var n="rgb("+[192*Math.random()|0,192*Math.random()|0,192*Math.random()|0].join(",")+")";node=d.html({style:{boxSizing:"border-box",border:"1px dotted "+n,zIndex:2147483647,position:"absolute",left:t.left+"px",top:this.getContextDocument().body.scrollTop+t.top+"px",height:t.bottom-t.top+"px",width:t.width+"px",fontWeight:"bold",overflow:"hidden",opacity:.6,color:n},text:""+e}),this.getContextDocument().body.appendChild(node)},t.prototype.__drawElementBounds=function(t,e){t=(t=d.getElement(t)).getBoundingClientRect();this.__drawRect(t,e)},t.prototype.__drawSeletionBounds=function(){var t=this.getContextWindow().getSelection();if(t.rangeCount){for(var e=this.getSelectionStyle(selection),n=0;n<t.rangeCount;++n){for(var o=(s=t.getRangeAt(n)).getClientRects(),i=0;i<o.length;++i)this.__drawRect(o[i],"r"+n+","+i),this.__drawRect(this.getCorrectedRangeRect(o[i],e),"r"+n+","+i+"c");this.__drawRect(s.getBoundingClientRect(),"b"+n+","),this.__drawElementBounds(s.commonAncestorContainer,"r"+n+"A")}var s=t.getRangeAt(t.rangeCount-1);return this.getCorrectedRangeRect(s,e)}}),window.selection=new t;var i,s,r,h,p,_,g,f,m,v,n,w,y,e,E,b,C,N=function(){this._storage=chrome.storage.local,this._options={},this._default={double_click_translate_enabled:!0,show_tooltip_enabled:!0,textarea_translate_enabled:!1,currency_convert_enabled:!0,conversion_notification_disabled:!1,conversion_notification_last:0,conversion_notification_type:1};var o=this;chrome.storage.onChanged.addListener(function(t,e){if("local"===e)for(var n in t)o._options[n]=t[n].newValue}),this.isTranslateEnabled=function(t){return"textarea"!==t||o.get("textarea_translate_enabled")},this.isDoubleClickTranslateEnabled=function(t){return!!o.isTranslateEnabled(t)&&o.get("double_click_translate_enabled")},this.isShowTooltipEnabled=function(){return o.get("show_tooltip_enabled")},this.isCurrencyConvertEnabled=function(){return o.get("currency_convert_enabled")}};function x(){options=new N,options.load();var i=null,r=null,c={POPUP_OPENED_SELECTION:10,POPUP_OPENED_DOUBLECLICK:11,POPUP_OPENED_CONTEXTMENU:12,POPUP_OPENED_NOTENPAGE:13,POPUP_OPENED_ENPAGE:14,POPUP_OPENED_DEFAULTSIZE:15,POPUP_OPENED_SCROLLSIZE:16},s=["calendar.google.com","docs.google.com","paper.dropbox.com"];function t(t){d.getNearest(t.target,".corom-element")?t.stopPropagation():(chrome.runtime.sendMessage({type:"close_popups"}),window.unitConversion&&window.unitConversion.isShown&&window.unitConversion.hide(!1))}function a(t){!function(t){t={timestamp_ms:t,page_url:window.location.href,type:"dictionary"};chrome.runtime.sendMessage({type:"report_custom_data",value:t})}(Date.now()),o(t);var e,n=l(),t=(e=new u,setTimeout(function(){var t=document.querySelector(".coccoc-scroll");t&&t.scrollHeight>t.clientHeight?e.resolve(c.POPUP_OPENED_SCROLLSIZE):e.resolve(c.POPUP_OPENED_DEFAULTSIZE)},500),e);n.success(function(t){o("en"===t?c.POPUP_OPENED_ENPAGE:c.POPUP_OPENED_NOTENPAGE)}),t.success(function(t){o(t)})}function l(){var e=new u;return chrome.runtime.sendMessage({type:"get_language"},function(t){t&&t.lang?e.resolve(t.lang.substring(0,2).toLowerCase()):e.resolve("un")}),e}function o(t){chrome.runtime.sendMessage({type:"report_small_count",name:"PopupOpened",value:t})}selection.onSelect.addListener(function(e){var t=window.location.hostname;if(-1===s.indexOf(t)){if(e.text=e.text.trim(),!e.text.length)return!1;var t=(t=(t=(t=e.text).toUpperCase()).match(/[\d.,]+\s?(?:''|”|"|INCHES|IN|FEETS|FTS|')?(?:\s?[X*]\s?[\d.,]+\s?(?:''|”|"|INCHES|IN|FEETS|FT|')?){1,2}/g)||t.match(/(?:C\$|HK\$|S\$|[$€￥¥円圓元£₩฿원]|USD|EUR|GBP|JPY|CNY|RMB|FR.|SFR.|CHF|CAD|HKD|SGD|KRW|THB|บาท)\s?[0-9.,]+|[0-9.,]+\s?(?:C\$|HK\$|S\$|[$€￥¥円圓元£₩฿원]|USD|EUR|GBP|JPY|CNY|RMB|FR.|SFR.|CHF|CAD|HKD|SGD|KRW|THB|บาท|MILE PER HOUR|MPH|MILE PER GALLON|MPG|MILES|MI|YARD|YARDS|YD|INCHES|IN|''|”|"|FEET|FEETS|FT|'|POUND|POUNDS|LB|OUNCE|OUNCES|OZ|TAEL|GAL|MPH|MPG|KWH|KW\/H)/g))&&t.length?t[0]:null,n=e.element.localName;if(e&&2!==e.detail&&t&&options.isCurrencyConvertEnabled())return e.text.match(/[^$€¥￥\,\.\d\s円圓元£₩฿원'"]/g)&&(e.copy=!0),e.conversionText=t,e.dblclickConversion=!1,void l().success(function(t){e.siteLang=t,unitConversion.show(e)});r={text:e.text,coords:e.coords,style:e.style};var t=!e.coords,t={text:e.text,notify:t},o=new u;chrome.runtime.sendMessage({type:"on_selection",data:t},function(t){o[t&&!t.error?"resolve":"reject"](t)}),o.success(function(t){"input"!==n&&options.isTranslateEnabled(n)&&(e.detail&&1===e.detail&&!options.isShowTooltipEnabled()||e.detail&&2===e.detail&&!options.isDoubleClickTranslateEnabled()||popup.show({data:t.translation,lang:t.langSrc,coords:e.coords,style:e.style,expand:!1}))}),i={text:e.text,request:o,source:n}}}),selection.onDeselect.addListener(function(t){t&&chrome.runtime.sendMessage({type:"disable_menu"}),null!==i&&(i.request.reject(),i=null),t||window.popup.hide()}),popup.onPopupShow.addListener(a.bind(this,c.POPUP_OPENED_SELECTION)),document.addEventListener("dblclick",setTimeout.bind(this,function(){i&&(this.getSelection().focusNode.parentElement,options.isDoubleClickTranslateEnabled(i.source)&&"input"!==i.source&&i.request.success(function(){a(c.POPUP_OPENED_DOUBLECLICK),popup.expanded=!0}))}),!1),window.addEventListener("resize",t,!1),document.addEventListener("contextmenu",t,!1),chrome.runtime.onMessage.addListener(function(t,e,n){switch(t.type){case"on_context_menu":if(!t.data)return;var o=t.data.translation;if(!o)return;var i=null,s=null,s=r&&r.text===t.data.originalText?(i=r.coords,r.style):(r=null,i=selection.getCoords(),selection.getStyle());if(null===i)return;a(c.POPUP_OPENED_CONTEXTMENU),popup.show({data:o,lang:t.data.langSrc,coords:i,style:s,expand:!0});break;case"close_popup":popup.hide()}}),function t(){if(!document.head&&!document.body)return setTimeout(t);document.querySelector('link[rel="stylesheet"], style')||(document.head||document.body).appendChild(document.createElement("style"))}()}function S(){this._init()}N.prototype={load:function(){var e=new u,n=this;return this._storage.get(null,function(t){n._options=t,e.resolve(t)}),e},set:function(t,e){var n={};"string"!=typeof t&&"number"!=typeof t||void 0===e||(n[t]=e,this._options[t]=e,this._storage.set(n))},get:function(t){return(t in this._options?this._options:this._default)[t]}},window.Options=N,function(){function t(){this._coords={top:0,left:0,bottom:0,right:0,width:0,height:0},this._isShown=!1,this._isExpanded=!1,this._createNodes(),this.onPopupShow=new Notifier}t.prototype={constructor:t,TRIGGER_INNER_HTML:'<div class="coccoc-tt-icon"></div>                          <div class="coccoc-tt-text">Dịch</div>',POPUP_INNER_HTML:"{{text}}",HORIZONTAL_GAP:window===window.top?20:0,VERTICAL_GAP:window===window.top?20:0,_createNodes:function(){var t=document.createElement("div");t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.right=0,t.style.height=0,t.style.margin=0,t.style.textAlign="left",t.style.zIndex=1e10,t.style.pointerEvents="none",t.style.border="none",t.style.all="initial",t.hidden=!0,t.classList.add("corom-element"),this._rootNode=t;var e=document.createElement("style");e.innerHTML='@import "'+chrome.extension.getURL("css/style.css")+'";',this._shadowRoot=d.attachShadow(t),this._shadowRoot.appendChild(e),this._createTriggerNode(),this._createPopupNode(),this._isExpanded=!1,window.addEventListener("pagehide",this._destroy.bind(this)),this._setPopupListener()},_createTriggerNode:function(){var t=document.createElement("div");t.classList.add("corom-trigger"),t.innerHTML=this.TRIGGER_INNER_HTML,t.hidden=!0,t.addEventListener("mouseup",function(t){this.expanded=!0,this.onPopupShow.trigger()}.bind(this),!1),this._triggerNode=t},_createPopupNode:function(){var t=document.createElement("div"),e=document.createElement("div");e.classList.add("corom-popup"),t.appendChild(e),t.style.left=0,t.style.right=0,t.style.pointerEvents="none",t.style.position="absolute",t.style.zIndex="10000000000000",t.hidden=!0,this._popupNode=t,this._popupNodeInner=e},_setText:function(t,e){this._currentTranslation={word:t.word,lang:e},t.incIndex=function(){++window.INDEX||(window.INDEX=1)},t.getIndex=function(){return window.INDEX},t.resetIndex=function(){"zh-CN"!==e&&(window.INDEX=0)},t.initIndex=function(){window.INDEX=0},t.existWriting=function(){return Boolean(t.writing)},89<=parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2])&&"en-GB"===e?(t.is_old_chromium=!1,t.phrases&&t.phrases.length&&(t.has_phrases=!0)):t.is_old_chromium=!0;var n=options.get("popup_template");this._popupNodeInner.innerHTML=o.render(n,t)},_setPopupListener:function(){this._popupNode.addEventListener("click",function(t){switch(t.target.id){case"btn_speaker":n(e.POPUP_ACTION_SPEAKER),chrome.runtime.sendMessage({type:"speak",word:this._currentTranslation.word,lang:this._currentTranslation.lang},function(t){"end"===t&&this._stopSpeaking()}.bind(this)),t.target.classList.add("btn-disabled");break;case"btn_setting":chrome.runtime.sendMessage({type:"open_options"}),n(e.POPUP_ACTION_SETTING);break;case"btn_more":window.open("https://www.coccoc.com/search#query="+this._currentTranslation.word+"%20meaning","_blank"),n(e.POPUP_ACTION_OPENLINK);break;case"btn_close":this.hide(!0);break;case"coccoc-synonym":n(e.POPUP_ACTION_SYNONYM)}}.bind(this))},_setScrollListener:function(){this._popupNodeInner.querySelector(".coccoc-scroll").addEventListener("scroll",function(){this._scrolled||(this._scrolled=!0,n(e.POPUP_ACTION_SCROLL))}.bind(this))},_stopSpeaking:function(){chrome.runtime.sendMessage({type:"stop_speaking"});var t=this._popupNode.querySelector("#btn_speaker");t&&t.classList.remove("btn-disabled")},_setStyle:function(t){var e=d.checkDarkPage();this._triggerNode.style.backgroundColor=e?"#fff":"#2A2B2B",this._triggerNode.style.setProperty("--triangleColor",this._triggerNode.style.backgroundColor),this._triggerNode.style.color=e?"#424242":"#fff"},_getActualPopupSize:function(){this._isShown||(this._popupNodeInner.style.left="-1000px",this._triggerNode.style.left="-1000px",this._popupNode.hidden=!1,this._shadowRoot.appendChild(this._popupNode));var t={width:this._popupNodeInner.offsetWidth||300,height:this._popupNodeInner.offsetHeight||250};return this._isShown||(this._popupNode.hidden=!this._isExpanded,this.hide()),t},_destroy:function(){null!==this._triggerNode&&(this._stopSpeaking(),this._triggerNode.remove(),this._popupNode.remove(),this._rootNode.remove(),this._shadowRoot=null,this._triggerNode=null,this._popupNode=null,this._popupNodeInner=null,this._rootNode=null)},get isShown(){return this._isShown},get coords(){return this._coords},set coords(t){var e=document.scrollingElement.scrollTop||window.pageYOffset,n=window.innerHeight,o=window.innerWidth,i=this._getActualPopupSize();t.top+i.height+this.VERTICAL_GAP>n?this._popupNode.style.top=t.top+e-i.height+"px":this._popupNode.style.top=t.top+t.height+e+"px",0<=t.top-45?(this._triggerNode.style.top=t.top+e-44-1+"px",this._triggerNode.classList.remove("coccoc-triangle-top"),this._triggerNode.classList.add("coccoc-triangle-bottom")):(this._triggerNode.style.top=t.top+e+t.height+8+1+"px",this._triggerNode.classList.remove("coccoc-triangle-bottom"),this._triggerNode.classList.add("coccoc-triangle-top")),this._triggerNode.style.setProperty("--triangleLeft","50%"),this._triggerNode.style.left=t.right-t.width/2-44+"px";o=Math.max(t.left+i.width+this.HORIZONTAL_GAP-o,0);this._popupNodeInner.style.left=Math.max(t.left-o,this.HORIZONTAL_GAP)+"px",this._coords=t},get expanded(){return this._isExpanded},set expanded(t){this._isExpanded=t,setTimeout(function(){this._triggerNode.hidden=t,this._popupNode.hidden=!t,this._rootNode.hidden=!1}.bind(this),0)},show:function(t){this._setText(t.data,t.lang),this.coords=t.coords,this._setStyle(t.style),this._injected||(this._shadowRoot.appendChild(this._popupNode),this._shadowRoot.appendChild(this._triggerNode),document.documentElement.appendChild(this._rootNode),this._injected=!0),this.expanded=Boolean(t.expand),this._isShown=!0,this._scrolled=!1,setTimeout(function(){this._setScrollListener()}.bind(this),0)},hide:function(t){(t||this._isShown)&&(this._stopSpeaking(),this._isExpanded=!1,this._triggerNode.hidden=!0,this._popupNode.hidden=!0,this._isShown=!1)}},window.popup=new t,document.addEventListener("mousedown",function(t){d.getNearest(t.target,".corom-element")?t.stopPropagation():window.popup.isShown&&window.popup.hide()},!1),x();var e={POPUP_ACTION_SPEAKER:0,POPUP_ACTION_OPENLINK:1,POPUP_ACTION_SYNONYM:2,POPUP_ACTION_SCROLL:3,POPUP_ACTION_SETTING:4};function n(t){chrome.runtime.sendMessage({type:"report_small_count",name:"PopupAction",value:t})}}(),r=2,h=3,p=4,_=5,g=6,f=7,m=i=0,v=s=1,S.prototype={_init:function(){this.TOOLTIP_MAIN=options.get("tooltip_main"),this.TOOLTIP_MORE_CURRENCIES=options.get("tooltip_more_currencies"),this.TOOLTIP_ADD_CURRENCIES=options.get("tooltip_add_currencies"),this._moneySymbolMap={$:"USD","€":"EUR","￥":"JPY","¥":"CNY","₫":"VND"},this._setupMain(),this._setupMoreCurrencies(),this._setupAddCurrencies(),window.addEventListener("pagehide",this._destroy.bind(this))},_setupMain:function(){var n=document.createElement("div");n.className="coccoc-money-main hidden",n.addEventListener("click",function(t){var e=t.target;switch(e.className){case"coccoc-btn-currencies":var n=this._tooltipMain.offsetLeft;this._tooltipMoreCurrencies.style.left=n+"px",this._tooltipMain.classList.add("hidden"),this._tooltipMoreCurrencies.classList.remove("hidden"),this._reportConversionAction(i);break;case"coccoc-value":n=e.innerText;this._copy(n);var o=e.parentNode;"coccoc-value-from"===o.className?this._reportConversionAction(s):"coccoc-value-to"===o.className&&this._reportConversionAction(r),o.classList.add("copied"),setTimeout(function(){o.classList.remove("copied")},400);n=this._tooltipMain.querySelector(".coccoc-btn-copy");n&&n.classList.remove("coccoc-copied");break;case"coccoc-btn-copy":this._reportConversionAction(p),this._copy(this._selectionData.text),e.classList.add("coccoc-copied"),setTimeout(function(){e.classList.remove("coccoc-copied")},400);break;case"coccoc-btn-close":this._reportConversionAction(f),this.hide()}}.bind(this)),n.addEventListener("mouseover",function(t){var e=t.target,t=n.querySelector(".coccoc-conversion");if(t)switch(e.className){case"coccoc-btn-info":t.classList.add("show-info");break;case"coccoc-btn-currencies":case"coccoc-btn-copy":case"coccoc-btn-close":t.classList.remove("show-info")}}),n.addEventListener("mouseleave",function(){var t=n.querySelector(".coccoc-conversion");t&&t.classList.remove("show-info")}),this._tooltipMain=n},_copy:function(t){var e=document.createElement("textarea");e.textContent=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.blur(),document.body.removeChild(e)},_setupMoreCurrencies:function(){var t=document.createElement("div");t.className="coccoc-more-currencies hidden",t.addEventListener("click",function(t){var e=t.target;switch(e.className){case"coccoc-more-back":this._reportConversionAction(g),this._tooltipMain.classList.remove("hidden"),this._tooltipMoreCurrencies.classList.add("hidden");break;case"coccoc-more-add":this._reportConversionAction(_),this._tooltipMoreCurrencies.classList.add("hidden"),this._tooltipAddCurrencies.classList.remove("hidden");break;case"coccoc-currency-value":case"coccoc-currency-sign":t=e.parentNode,e=(e=t.innerText).replace(/\n/g," ");this._copy(e);var n=t.parentNode;n.classList.add("copied"),setTimeout(function(){n.classList.remove("copied")},400)}}.bind(this)),this._tooltipMoreCurrencies=t},_setupAddCurrencies:function(){var t=document.createElement("div");t.className="coccoc-add-currencies hidden",this._tooltipAddCurrencies=t},_setStyle:function(){this._tooltipMain.classList.add("coccoc-dark-theme"),this._tooltipMoreCurrencies.classList.add("coccoc-dark-theme"),this._tooltipAddCurrencies.classList.add("coccoc-dark-theme")},set coords(t){var e,n=document.scrollingElement.scrollTop||window.pageYOffset,o=(document.scrollingElement.scrollLeft||window.pageXOffset,window.innerHeight,window.innerWidth),i=t.top-45,s=this._selectionData.copy?380:260;this._tooltipMain.style.top=(0<=i?i+n:t.top+n+t.height+8+1)+"px",e=Math.max(t.left+t.width/2+s/2+20-o,0);s=Math.max(t.left+t.width/2-s/2-e,20);this._tooltipMain.style.left=s+"px",i=t.top-130-8-1,this._tooltipMoreCurrencies.style.top=(0<=i?i+n:t.top+n+t.height+8+1)+"px",e=Math.max(t.left+t.width/2+82.5+20-o,0),s=Math.max(t.left+t.width/2-82.5-e,20),this._tooltipMoreCurrencies.style.left=s+"px",i=t.top-45-8-1,this._tooltipAddCurrencies.style.top=(0<=i?i+n:t.top+n+t.height+8+1)+"px",e=Math.max(t.left+t.width/2+143.5+20-o,0),s=Math.max(t.left+t.width/2-143.5-e,20),this._tooltipAddCurrencies.style.left=s+"px"},_format:function(t,e){var n=/\d(?=(\d{3})+(?:\.|$))/g,o=t.toString().split("."),o=o[0].replace(n,"$&,")+"."+(o[1]||"00"),i="";if("VND"===e){for(;1e9<=t;)t/=1e9,i=" tỷ"+i;""!==i&&1e6<=t&&(t/=1e6,i=" triệu"+i),""!==i&&1e3<=t&&(t/=1e3,i=" nghìn"+i),i=t<1e3?t.toFixed(2).substr(0,100<=t?3:4)+i:t.toFixed(0).replace(n,"$&,")}else i=t.toFixed(2).replace(n,"$&,");return{exact:o,semantic:i}},_extractInputData:function(t){var e=/(C\$|HK\$|S\$|[$€￥¥円圓元£₩฿원]|USD|EUR|GBP|JPY|CNY|RMB|FR.|SFR.|CHF|CAD|HKD|SGD|KRW|THB|บาท)[^\S\r\n]?([1-9][0-9]{0,2}(?:,[0-9]{3})+(?:\.[0-9]{1,})?|[1-9][0-9]{1,2}(?:\.[0-9]+)+(?:,[0-9]{1,})?|[0-9]+(?:[.,][0-9]{1,})?)|([1-9][0-9]{0,2}(?:,[0-9]{3})+(?:\.[0-9]{1,})?|[1-9][0-9]{0,2}(?:\.[0-9]+)+(?:,[0-9]{1,})?|[0-9]+(?:[.,][0-9]{1,})?)[^\S\r\n]?(C\$|HK\$|S\$|[$€￥¥円圓元£₩฿원]|USD|EUR|GBP|JPY|CNY|RMB|FR.|SFR.|CHF|CAD|HKD|SGD|KRW|THB|บาท|GAL|US GAL LQD|GALLON LIQUID US|US GAL|MPH|MILE PER HOUR|MPG|MILE PER GALLON|MILES|MI|YARD|YARDS|YD|INCHES|IN|''|”|"|FEET|FEETS|FT|'|POUND|POUNDS|LB|OUNCE|OUNCES|OZ|TAEL|KWH|KW\/H)?/g,n=/(?:[0-9]{1,3}(?:,[0-9]{3})+(?:\.[0-9]{1,})?|[0-9]+(?:\.[0-9]{1,}))(\n|$)/g,o=null,i="",s="units";if(/[\d.,]+\s?(?:''|”|"|INCHES|IN|FEETS|FT|')?(?:\s?[X*]\s?[\d.,]+\s?(?:''|”|"|INCHES|IN|FEETS|FT|')?){1,2}/g.test(t.conversionText))for(var r=null;r=e.exec(t.conversionText);){var c=r[2]||r[3];(o=o||[]).push(c),i=i||r[1]||r[4]}else(r=e.exec(t.conversionText))&&r.length&&(o=[r[2]||r[3]],i=i||r[1]||r[4]);if(!o||!i)return null;for(var a=["vi","de","fr","id","it","ru"],l=0;l<o.length;l++)n.test(o[l])&&a.indexOf(t.siteLang)<0?o[l]=o[l].replace(/,/g,""):o[l]=o[l].replace(/\./g,"").replace(/,/,"."),n.lastIndex=0;return-1!==["C$","HK$","S$","$","€","￥","¥","円","圓","元","£","₩","원","฿","บาท","USD","EUR","GBP","JPY","CNY","RMB","FR.","SFR.","CHF","CAD","HKD","SGD","KRW","THB"].indexOf(i)&&(s="currency"),{type:s,value:o,sign:i}},_convertData:function(t){var e=new u;return"currency"===t.type?this._convertCurrency(t).success(function(t){e.resolve(t)}):this._convertUnit(t).success(function(t){e.resolve(t)}),e},_convertCurrency:function(n){var o=new u,i=this._standardSymbol(n.sign);return chrome.runtime.sendMessage({type:"get_exchange_rate",money:i},function(t){var e;t?(e={type:"currency",inputData:{rawSign:n.sign,abbr:i,text:n.sign+" "+this._format(parseFloat(n.value[0])).exact},outputData:{},currencies:[]},t=this._calculateExchangeReturn(t,n.value[0]),e.outputData.semantic=t.vndValue.semantic+(-1!==t.vndValue.semantic.indexOf("tỷ")?" VNĐ":" ₫"),e.outputData.exact=t.vndValue.exact+" ₫",e.currencies=t.currencies,o.resolve(e)):o.resolve(null)}.bind(this)),o},_convertUnit:function(t){var e=new u,n=this._standardSymbol(t.sign),o={MILES:[1.60934,"km"],YARDS:[.9144,"m"],FEETS:[.3048,"m"],INCHES:[2.54,"cm"],POUNDS:[.453592,"kg"],OUNCES:[28.3495,"g"],TAEL:[37.7994,"g"],GAL:[3.78541,"l"],MPH:[1.61,"km/h"],MPG:[.42514,"km/l"],"KW/H":[1e3,"W/h"]},i={type:"unit",inputData:{rawSign:t.sign,abbr:n,text:""},outputData:{}};-1!==['"',"”","''","'"].indexOf(t.sign)?i.inputData.text=t.value.join(t.sign+" x ")+t.sign:i.inputData.text=t.value.join(" x ")+" "+t.sign.toLowerCase();var s=[];return t.value.forEach(function(t){s.push(this._format(parseFloat(o[n][0])*parseFloat(t)).semantic)}.bind(this)),i.outputData.semantic=s.join(" x ")+" "+o[n][1],i.outputData.exact=s.join(" x ")+" "+o[n][1],e.resolve(i),e},_standardSymbol:function(t){var e="";switch(t){case"¥":case"￥":e="zh"===this._selectionData.siteLang?"CNY":"JPY";break;case"元":case"CNY":case"RMB":e="CNY";break;case"圓":case"円":case"JPY":e="JPY";break;case"$":case"USD":e="USD";break;case"€":case"EUR":e="EUR";break;case"£":case"GBP":e="GBP";break;case"FR.":case"SFR.":case"CHF":e="CHF";break;case"C$":case"CAD":e="CAD";break;case"HK$":case"HKD":e="HKD";break;case"S$":case"SGD":e="SGD";break;case"₩":case"원":case"KRW":e="KRW";break;case"฿":case"บาท":case"THB":e="THB";break;case"''":case"”":case'"':case"IN":case"INCHE":case"INCHES":e="INCHES";break;case"'":case"FT":case"FTS":case"FEET":case"FEETS":e="FEETS";break;case"LB":case"LBS":case"POUND":case"POUNDS":e="POUNDS";break;case"MI":case"MILES":e="MILES";break;case"YD":case"YARD":e="YARDS";break;case"OZ":case"OUNCE":case"OUNCES":e="OUNCES";break;case"KWH":case"KW/H":e="KW/H";break;case"MPH":case"MILE PER HOUR":e="MPH";break;case"GAL":case"GALLON":case"GALLONS":case"US GAL":case"GALLON LIQUID US":case"US GAL LQD":e="GAL";break;case"MPG":case"MILE PER GALLON":e="MPG";break;default:e=t}return e},_calculateExchangeReturn:function(e,n){var o={vndValue:{},currencies:[]};return Object.keys(this._moneySymbolMap).forEach(function(t){"₫"!==t?o.currencies.push({short:this._moneySymbolMap[t],value:this._format(parseFloat(e[this._moneySymbolMap[t]]||1)*parseFloat(n),this._moneySymbolMap[t]).semantic,sign:this._moneySymbolMap[t]===n.currency?n.symbol:t}):o.vndValue=this._format(parseFloat(e.VND)*parseFloat(n),"VND")}.bind(this)),o},show:function(n){this._selectionData=n;var t=this._extractInputData(n);t&&(this._convertData(t).success(function(t){var e={isCurrencyConvert:"currency"===t.type,value_from:t.inputData.text,value_to:t.outputData,btn_copy:n.copy,currencies:t.currencies,rate_source:"CNY"===t.inputData.abbr?"www.bidv.com.vn":"www.vietcombank.com.vn"};this._tooltipMain.innerHTML=o.render(this.TOOLTIP_MAIN,e),this._tooltipMoreCurrencies.innerHTML=o.render(this.TOOLTIP_MORE_CURRENCIES,e),this._tooltipAddCurrencies.innerHTML=o.render(this.TOOLTIP_ADD_CURRENCIES,e),this._setStyle(),this.coords=n.coords,this._tooltipMain.classList.remove("hidden"),this.isShown=!0,popup._rootNode.hidden=!1,this._reportConversionOpened(n.dblclickConversion?v:m),n.copy&&this._reportConversionAction(h),this._reportConversionData(Date.now(),t.type),this._reportNotification()}.bind(this)),this._injected||(popup._shadowRoot.appendChild(this._tooltipMain),popup._shadowRoot.appendChild(this._tooltipMoreCurrencies),popup._shadowRoot.appendChild(this._tooltipAddCurrencies),document.documentElement.appendChild(popup._rootNode,document.body),this._injected=!0))},hide:function(t){this.isShown&&(this._tooltipMain.classList.add("hidden"),this._tooltipMoreCurrencies.classList.add("hidden"),this._tooltipAddCurrencies.classList.add("hidden"),this.isShown=!1,t&&this._reportConversionAction(f))},_destroy:function(){this._tooltipMain&&(this._tooltipMain.remove(),this._tooltipMain=null),this._tooltipMoreCurrencies&&(this._tooltipMoreCurrencies.remove(),this._tooltipMoreCurrencies=null),this._tooltipAddCurrencies&&(this._tooltipAddCurrencies.remove(),this._tooltipAddCurrencies=null)},_reportConversionAction:function(t){chrome.runtime.sendMessage({type:"report_small_count",name:"ConversionAction",value:t})},_reportConversionOpened:function(t){chrome.runtime.sendMessage({type:"report_small_count",name:"ConversionOpened",value:t})},_reportConversionData:function(t,e){e={timestamp_ms:t,page_url:window.location.href,type:"converter:"+e};chrome.runtime.sendMessage({type:"report_custom_data",value:e})},_reportNotification:function(){var t=options.get("conversion_notification_last"),e=options.get("conversion_notification_user"),n=Date.now();!e||!t||t&&864e5<n-t||(e={user_group:e},chrome.runtime.sendMessage({type:"report_conversion_shown",data:e}))}},document.addEventListener("mousedown",function(t){!d.getNearest(t.target,".corom-element")&&window.unitConversion&&window.unitConversion.isShown&&window.unitConversion.hide(!0)}),window.addEventListener("DOMContentLoaded",function(){window.unitConversion=new S}),C=chrome.i18n.getMessage,window===window.top&&(n="user_ignored",w="already_use",y="try_now",e=null,E={amazon:{url_regex:/www\.amazon\.com/,price_selector:"#priceblock_ourprice, #priceblock_dealprice"},ebay:{url_regex:/ebay\.com/,price_selector:"#prcIsum"},alibaba:{url_regex:/www\.alibaba\.com/,price_selector:".ma-ref-price, .ma-spec-price"},aliexpress:{url_regex:/aliexpress\.com/,price_selector:"div > #j-sku-discount-price, div > #j-sku-price"},zara:{url_regex:/zara\.com(?!(?:\/vn))/,price_selector:".price._product-price"},hm:{url_regex:/hm\.com/,price_selector:".price-value"},uniqlo:{url_regex:/uniqlo\.com/,price_selector:"#price, .price-sales.pdp-space-price"},rakuten:{url_regex:/rakuten\.co\.jp/,price_selector:".price2"},banggood:{url_regex:/banggood\.com/,price_selector:".item_now_price, .item_old_price"},gearbest:{url_regex:/gearbest\.com/,price_selector:".goodsIntro_promoPrice > .goodsIntro_priceWrap > .goodsIntro_price, .goodsIntro_priceWrap > .goodsIntro_price"},1688:{url_regex:/detail\.1688\.com\/offer\/\d+\.html/,price_selector:"span.price-now, .price-original-sku > span.value, .price span.value"},dmm:{url_regex:/dmm\.com/,price_selector:".now-result, .price"},taobao:{url_regex:/taobao\.com/,price_selector:"#J_StrPrice"},tmall:{url_regex:/tmall\.com/,price_selector:".tm-price"}},(t=function(){this._isShown=!1}).prototype={constructor:t,_init:function(){this._tooltipNode=this._createNotiTooltipNode(),this._tooltipNode&&(this._waveNode=this._createWaveNode(),window.addEventListener("mousedown",function(t){d.getNearest(t.target,".corom-element")?t.stopPropagation():this._isShown&&(this._reportOnboardingClick("out"),this._destroy(n))}.bind(this),!1),window.popup._shadowRoot.appendChild(this._tooltipNode),this._waveNode&&window.popup._shadowRoot.appendChild(this._waveNode),document.documentElement.appendChild(popup._rootNode,document.body))},_createNotiTooltipNode:function(){var t=options.get("tooltip_notification");if(!t)return null;var e=document.createElement("div");return e.classList.add("conversion-notification"),e.classList.add("hidden"),e.innerHTML=o.render(t,{conversion_noti_header:C("conversion_noti_header"),conversion_noti_message:C("conversion_noti_message"),conversion_btn_already:C("conversion_btn_already"),conversion_btn_try:C("conversion_btn_try")}),e.addEventListener("click",function(t){switch(t.target.id){case"noti_btn_close":this._reportOnboardingClick("close"),this._destroy(n);break;case"noti_btn_already":this._reportOnboardingClick("already"),this._destroy(w);break;case"noti_btn_try":this._reportOnboardingClick("try"),this._destroy(y)}}.bind(this)),e},_createWaveNode:function(){var t=options.get("tooltip_wave_focusing");if(!t)return null;var e=document.createElement("div");return e.classList.add("tooltip-wave-wrapper"),e.classList.add("hidden"),e.innerHTML=t,e},_setPosition:function(t){e=(n=t).getBoundingClientRect(),t=window.pageXOffset||document.documentElement.scrollLeft,n=window.pageYOffset||document.documentElement.scrollTop,n={top:e.top+n,left:e.left+t,width:e.width,height:e.height},t=window.innerWidth;this._tooltipNode.style.top=n.top-136-10+"px";var e=n.left+(window.location.hostname.includes("dmm.com")?50:0);t<e+352+20&&(e=t-20-352),this._tooltipNode.style.left=e+"px",this._tooltipNode.classList.remove("hidden"),this._waveNode.style.top=n.top+n.height/2-5+"px";var n=n.left+(window.location.hostname.includes("dmm.com")?70:20);this._waveNode.style.left=n+"px",this._waveNode.classList.remove("hidden"),this._tooltipNode.style.setProperty("--triangleLeft",n-e+5+"px")},show:function(){this._init(),this._posInterval=setInterval(this._relocatePosition.bind(this),1e3)},_relocatePosition:function(){var t;options.get("conversion_notification_disabled")?this._destroy():(t=(t=d.query(e))&&d.query(e))&&(this._setPosition(t),(t=d.query(".sufei-dialog"))&&"none"!==t.style.display&&(window.location.hostname.includes("taobao.com")||window.location.hostname.includes("tmall.com"))?(window.popup._rootNode.style.display="none",this._isShown=!1):(window.popup._rootNode.style.display="block",this._isShown=!0))},_destroy:function(t){this._isShown&&(this._tooltipNode.classList.add("hidden"),this._waveNode.classList.add("hidden"),this._isShown=!1,this._posInterval&&clearInterval(this._posInterval),options.get("conversion_notification_disabled")||(options.set("conversion_notification_disabled",!0),options.set("conversion_notification_last",Date.now()),options.set("conversion_notification_user",t)))},_reportOnboardingClick:function(t){chrome.runtime.sendMessage({type:"report_onboarding_click",data:{click_type:t}})}},window.conversionNotification=new t,b=function(t){for(var e=Object.keys(E),n=0;n<e.length;n++)if(t.match(E[e[n]].url_regex))return e[n];return null}(window.location.href),window.addEventListener("DOMContentLoaded",function(){options.get("conversion_notification_disabled")||b&&(e=E[b].price_selector,conversionNotification.show())}))}("undefined"==typeof global&&(global={}));